name: R to GitHub Pages

on:
  push:
    branches: [ "main" ]
  schedule:
    - cron: '0 23 * * *'
  workflow_dispatch:

env:
  BASE_BRANCH_NAME: main
  HOSTING_BRANCH_NAME: gh-pages
  LOCAL_BRANCH_NAME: gh-pages-local
  
jobs:
  Build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v4
        with:
              python-version: '2.7'
      - uses: r-lib/actions/setup-r@v2
        with:
              r-version: '4.2.2'
    - name: Setup git
      run: |
        git config user.name "GitHub Actions Bot"
        git config user.email "<>"
        cd $GITHUB_WORKSPACE
        git fetch          
    - name: Clean up
        continue-on-error: true
        run: |
          git branch -d $LOCAL_BRANCH_NAME
    - run: 
        Rscript -e 'system("pip install pandoc"); install.packages(c("png", "rmarkdown"), repos = "https://cran.ism.ac.jp/")'
        Rscript -e 'rmarkdown::render("Crypto.Rmd")'


        